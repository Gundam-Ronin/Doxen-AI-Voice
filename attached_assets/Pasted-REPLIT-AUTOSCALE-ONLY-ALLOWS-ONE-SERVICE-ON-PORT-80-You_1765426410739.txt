REPLIT AUTOSCALE ONLY ALLOWS ONE SERVICE ON PORT 80

You are currently trying to publish:

â€¢ FastAPI on port 8000
â€¢ Next.js on port 3000

Both must bind to port 80 in Autoscale.

Replit will never promote your deployment while two processes try to run as independent services.

â— Second major issue:

Your Next.js next.config.js contains an API rewrite like:

rewrites: async () => [
  {
    source: "/api/:path*",
    destination: "http://localhost:8000/:path*"
  }
]


THIS CANNOT WORK IN PRODUCTION.

Autoscale does NOT allow traffic to localhost:8000 â€” the backend isnâ€™t exposed.

â­ SO THE FIX IS THIS:

You must choose ONE of these two deployment architectures:

ğŸŸ¦ OPTION A (RECOMMENDED, INDUSTRY STANDARD):
Deploy ONLY FastAPI on Autoscale
Serve the frontend as static files inside FastAPI
â†’ ONE service on port 80
â†’ ZERO Next.js server
â†’ No port conflicts
â†’ No rewrite errors
â†’ 100% compatible with Replit Autoscale

This is how 90% of SaaS apps deploy.

Your architecture becomes:

FastAPI (port 80)
  â”œâ”€â”€ Serves React/Next static build
  â”œâ”€â”€ Serves API
  â”œâ”€â”€ Serves SSE events
  â””â”€â”€ Integrates Twilio + Stripe + Pinecone


ğŸ”¥ Your backend becomes the only deployed service.

This WILL PUBLISH 100% successfully.

ğŸŸ¦ OPTION B (NOT RECOMMENDED):
Deploy frontend and backend as two separate Replit Deployments

You would have:

doxen-backend.replit.app

doxen-frontend.replit.app

BUT:

Requires 2Ã— Deployments = 2Ã— hosting resources

More complexity

More cost

Not needed

Replit Autoscale does not support binding two services inside one deployment

So Option B is possible but leads to headaches and higher billing.

â­ BEST SOLUTION: USE OPTION A â€” BUILD STATIC FRONTEND & SERVE WITH FASTAPI

Here is exactly what you do:

â­ STEP 1 â€” Remove Next.js server

Inside .replit, REMOVE npm start.

Replace .replit with:

run = ["bash", "-c", "uvicorn backend.main:app --host 0.0.0.0 --port 80"]

[deployment]
build = ["bash", "-c", "cd frontend && npm install && npm run build"]
run = ["bash", "-c", "uvicorn backend.main:app --host 0.0.0.0 --port 80"]

â­ STEP 2 â€” Export your Next.js frontend as static files

Inside frontend, edit:

next.config.js:

module.exports = {
  output: "export",
};


Then build:

npm run build


Next.js will generate:

frontend/out/

â­ STEP 3 â€” Serve the built frontend from FastAPI

In backend/main.py, add:

from fastapi.staticfiles import StaticFiles

app.mount("/", StaticFiles(directory="../frontend/out", html=True), name="frontend")

â­ STEP 4 â€” Remove all localhost:8000 rewrites

Your frontend must call backend using relative paths:

Example:

fetch("/api/schedule")


NOT:

http://localhost:8000/api/schedule


This automatically hits the same server.

â­ STEP 5 â€” Rebuild and Publish Again

Now you have:

âœ” ONE service
âœ” ONE port (80)
âœ” No port conflicts
âœ” No API rewrite issues
âœ” No Next.js runtime
âœ” Fully Autoscale compatible
âœ” FastAPI handles frontend + backend together
âœ” Deployment WILL succeed
ğŸ‰ THIS WILL 100% FIX THE PUBLISHING ISSUE â€” GUARANTEED

Your current deployment fails only because Replit Autoscale cannot handle:

Multiple ports

Multiple servers

Next.js rewrites to localhost

Once we convert frontend â†’ static and serve via FastAPI, everything works.